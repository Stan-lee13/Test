<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CJ Dropshipping Store Test</title>
</head>
<body>
  <h1>CJ Dropshipping Products</h1>
  <input type="text" id="token" placeholder="Enter CJ Access Token" style="width: 300px;">
  <input type="email" id="email" placeholder="Enter CJ Email" style="width: 300px;">
  <button id="fetchBtn">Fetch Products</button>

  <div id="products" style="margin-top: 20px;"></div>

  <script>
    document.getElementById('fetchBtn').addEventListener('click', async () => {
      const token = document.getElementById('token').value;
      const email = document.getElementById('email').value;

      if (!token || !email) {
        alert('Please enter both token and email');
        return;
      }

      const productsDiv = document.getElementById('products');
      productsDiv.innerHTML = 'Loading...';

      try {
        const response = await fetch('/api/products', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token, email })
        });

        const data = await response.json();

        if (data.error) {
          productsDiv.innerHTML = 'Error: ' + data.error;
          return;
        }

        if (!data.list || data.list.length === 0) {
          productsDiv.innerHTML = 'No products found';
          return;
        }

        // Display products
        productsDiv.innerHTML = data.list.map(p => `
          <div style="border:1px solid #ccc; padding:10px; margin:10px;">
            <h3>${p.productName}</h3>
            <img src="${p.imageList?.[0]}" width="150">
            <p>Price: $${p.price}</p>
          </div>
        `).join('');

      } catch (err) {
        productsDiv.innerHTML = 'Fetch failed: ' + err.message;
      }
    });
  </script>
</body>
</html>